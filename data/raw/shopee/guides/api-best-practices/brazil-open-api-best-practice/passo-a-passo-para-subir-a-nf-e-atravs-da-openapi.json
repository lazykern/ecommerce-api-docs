{
  "category_name": "API Best Practices / Brazil Open API Best Practice",
  "category_id": 2067,
  "document_id": 382,
  "release_time": 1721793320,
  "update_time": 1721793320,
  "operator": "grace.li@shopee.com",
  "title": "Passo a passo para subir a NF-e através da OpenAPI",
  "raw_content": "[{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Na Shopee, para vendedores CNPJ é necessário que seja adicionado a Nota Fiscal no pedido, exceto para pedidos com o parceiro logístico que não tem suporte a Nota Fiscal, como por exemplo o Correios.\"}]},{\"name\":\"paragraph\"},{\"name\":\"heading2\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"Dados Necessários do Comprador para Emissão de NF-e\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Os dados podem ser obtidos através do endpoint \"},{\"attributes\":{\"bold\":true,\"linkHref\":\"https://open.shopee.com/documents/v2/v2.order.get_order_detail?module=94&type=1\"},\"data\":\"v2.order.get_order_detail\"},{\"attributes\":{\"bold\":true},\"data\":\" \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"com os valores indicados no parâmetro \\\"response_optional_fields\\\". No entanto, para aprimorar nossas políticas de proteção de dados, desde o dia 28 de Dezembro, os dados serão mascarados conforme:\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"1. Vendedor CPF:\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Disponibilizado apenas o \\\"Endereço\\\" do comprador, para orders com status \\\"READY_TO_SHIP\\\", \\\"PROCESSED\\\" e \\\"RETURN/REFUND\\\" na API (\\\"TO_SHIP\\\" e ˜R/R˜ no Seller Center).\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"\\\"Nome\\\", \\\"Número\\\" de \\\"telefone\\\" e \\\"CPF\\\" do Buyer não será disponibilizado em nenhum status da order, pois não é necessário;\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\"},{\"attributes\":{\"src\":\"https://down-br.img.susercontent.com/br-11134141-7r98o-lncwzappgq1b20\",\"alt\":\"\"},\"name\":\"imageBlock\"},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"2. Sellers CNPJ:\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Disponibilizados “Nome”, “Endereço” e “CPF” do buyer para orders com status “INVOICE_PENDING”, “READY_TO_SHIP”, “PROCESSED” e “RETURN/REFUND˜ na API (“TO_SHIP” e “R/R” no Seller Center)\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"O “telefone” do Buyer não será disponibilizado em nenhum status da order, pois não é necessário;\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\"},{\"attributes\":{\"src\":\"https://down-br.img.susercontent.com/br-11134141-7r98o-lncwzll7jtm18e\",\"alt\":\"\"},\"name\":\"imageBlock\"},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"rgb(255,255,255)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Essa nova regra não deve afetar os atuais fluxos da order pois os dados não são obrigatórios para nenhuma etapa do processo.\"}]},{\"name\":\"paragraph\"},{\"name\":\"heading2\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"Cálculo para Emissão de NF-e\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Os valores para emissão da NF podem ser obtidos através do endpoint \"},{\"attributes\":{\"bold\":true,\"linkHref\":\"https://open.shopee.com/documents/v2/v2.payment.get_escrow_detail?module=97&type=1\"},\"data\":\"v2.payment.get_scrow_detail\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" como no cálculo abaixo:\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Valor total da NF = \\\"original_price\\\" - \\\"seller_discount\\\" - \\\"discount_from_voucher_seller\\\" + \\\"buyer_paid_shipping_fee\\\"\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Lembrando que isso é apenas uma das formas de calcular o valor da NF, caso seu time Fiscal apresente outra forma, não necessariamente estará incorreta.\"}]},{\"name\":\"paragraph\"},{\"name\":\"heading2\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Verificando pedidos que precisam da NF-e\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"1. Chamar o endpoint \"},{\"attributes\":{\"bold\":true,\"linkHref\":\"https://open.shopee.com/documents/v2/v2.order.get_order_list?module=94&type=1\"},\"data\":\"v2.order.get_order_list\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" e passar o parâmetro opcional \\\"order_status\\\" com o valor \\\"INVOICE_PENDING\\\", dessa forma será retornado uma lista de pedidos que precisam ter a NF-e adicionada antes da organização de envio do pedido.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ex de chamada em cURL:\"}]},{\"name\":\"paragraph\"},{\"attributes\":{\"language\":\"python\"},\"name\":\"codeBlock\",\"children\":[{\"data\":\"curl --location --request GET 'https://partner.shopeemobile.com/api/v2/order/get_order_list?partner_id=XXXX&timestamp=XXXX&access_token=XXXX&shop_id=XXXX&sign=XXXXXXXXXXXX&time_range_field=XXXX&time_from=XXXX&time_to=XXXX&page_size=100&order_status=INVOICE_PENDING' \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--data-raw ''\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ex de response:\"}]},{\"name\":\"paragraph\"},{\"attributes\":{\"language\":\"python\"},\"name\":\"codeBlock\",\"children\":[{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"error\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"message\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"response\\\":{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"more\\\":false,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"next_cursor\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_list\\\":[\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_sn\\\":\\\"22002XXXXXXXX\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_sn\\\":\\\"22003XXXXXXXX\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_sn\\\":\\\"22001XXXXXXXX\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"}\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"]\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"request_id\\\":\\\"XXXXXXXX\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"}\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"2. Para verificar se a NF-e já está atrelada ao order_sn, basta utilizar o endpoint \"},{\"attributes\":{\"linkHref\":\"https://open.shopee.com/documents/v2/v2.order.get_order_detail?module=94&type=1\"},\"data\":\"v2.order.get_order_detail\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\", com o parâmetro opcional: \\\"response_optional_fields\\\": \\\"invoice_data\\\" e a order_sn, dessa forma será retornado na response o objeto \\\"invoice_data\\\". \"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ex de chamada em cURL:\"}]},{\"name\":\"paragraph\"},{\"attributes\":{\"language\":\"python\"},\"name\":\"codeBlock\",\"children\":[{\"data\":\"curl --location --request GET 'https://partner.shopeemobile.com/api/v2/order/get_order_detail?partner_id=XXXXX&timestamp=XXXXX&access_token=XXXXX&shop_id=XXXXX&sign=XXXXX&order_sn_list=22002XXXXXXXX&response_optional_fields=invoice_data' \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--header 'Content-Type: application/json' \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--data-raw ''\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"a) Caso a order_sn já possua a invoice, então será retornado um objeto com os valores da NF-e.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ex de response, order_sn com NF-e:\"}]},{\"name\":\"paragraph\"},{\"attributes\":{\"language\":\"python\"},\"name\":\"codeBlock\",\"children\":[{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"error\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"message\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"response\\\":{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_list\\\":[\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"cod\\\":false,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"create_time\\\":1662490093,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"currency\\\":\\\"BRL\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"days_to_ship\\\":2,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"invoice_data\\\":{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"number\\\":\\\"000000XXX\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"series_number\\\":\\\"00X\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"access_key\\\":\\\"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"issue_date\\\":1662492013,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"total_value\\\":100,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"products_total_value\\\":100,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"tax_code\\\":\\\"5101\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"message_to_seller\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_sn\\\":\\\"22002XXXXXXXX\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_status\\\":\\\"READY_TO_SHIP\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"prescription_check_status\\\":null,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"region\\\":\\\"BR\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"reverse_shipping_fee\\\":0,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"ship_by_date\\\":1662606000,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"update_time\\\":1662492365\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"}\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"]\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"request_id\\\":\\\"e631c3f1b4fe93a54a696a3229xxxxxx\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"}\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"b) Caso a order_sn ainda não possua a invoice, então será retornado um objeto vazio, uma vez que ainda não consta os valores da NF-e em nosso sistema.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ex de response, order_sn sem NF-e:\"}]},{\"name\":\"paragraph\"},{\"attributes\":{\"language\":\"python\"},\"name\":\"codeBlock\",\"children\":[{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"error\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"message\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"response\\\":{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_list\\\":[\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"{\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"cod\\\":false,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"create_time\\\":1663009716,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"currency\\\":\\\"BRL\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"days_to_ship\\\":2,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"invoice_data\\\":{},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"message_to_seller\\\":\\\"\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_sn\\\":\\\"22002XXXXXXXX\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"order_status\\\":\\\"READY_TO_SHIP\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"prescription_check_status\\\":null,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"region\\\":\\\"BR\\\",\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"reverse_shipping_fee\\\":0,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"ship_by_date\\\":0,\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"update_time\\\":1663009855\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"}\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"]\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"},\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"\\\"request_id\\\":\\\"c8691da53612d1bc8ee5bb97dxxxxxx\\\"\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"}\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"⚠️ Nota\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"O status do pedido retornado no v2.order.get_order_detail, não é alterado depois de chamar a API add_invoice_data, tanto as orders que ainda não possuem a NF-e adicionada, quanto as orders que já possuem a NF-e adicionadas, vão apresentar o \\\"order_status\\\":\\\"READY_TO_SHIP\\\". O status apenas é modificado na API v2.order.get_order_list, para o parâmetro de filtro (INVOICE_PENDING)\"}]},{\"name\":\"paragraph\"},{\"name\":\"heading2\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"Adicionando o Invoice\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"data\":\"Com a order_sn no status INVOICE_PENDING, ou após validar se a order tem Invoice_data, então pode-se usar a seguinte API para upload de invoice:\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"data\":\"-\"},{\"attributes\":{\"bold\":true,\"linkHref\":\"https://open.shopee.com/documents/v2/v2.order.upload_invoice_doc?module=94&type=1\"},\"data\":\" v2.order.upload_invoice_doc\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" para subir um arquivo XML, onde os parâmetros são:\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"order_sn:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" valor retornado na chamada anterior (v2.order.get_order_list)\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"file_type: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"o tipo de arquivo, que para XML é “4”;\"}]},{\"attributes\":{\"listIndent\":0,\"listType\":\"numbered\"},\"name\":\"listItem\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"file:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" que deve ser adicionado o caminho (ou “Path) do arquivo XML;\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ex de chamada em cURL:\"}]},{\"name\":\"paragraph\"},{\"attributes\":{\"language\":\"python\"},\"name\":\"codeBlock\",\"children\":[{\"data\":\"curl --location 'https://partner.shopeemobile.com/api/v2/order/upload_invoice_doc?partner_id=XXXXXX&timestamp=1682618933&access_token=XXXXXXXXXXXXXXXX&shop_id=XXXXXXX&sign=XXXXXXXXXXXXXX’ \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--header 'Content-Type: application/json' \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--form 'file=@\\\"path/to/file\\\"' \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--form 'order_sn=\\\"2304278N5XXXXXXX\\\"' \\\\\"},{\"name\":\"softBreak\"},{\"name\":\"softBreak\"},{\"data\":\"--form 'file_type=\\\"4\\\"\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Nota: Solicitamos que essa API seja chamada com um delay de 5 minutos após a criação da NF-e. Por conta da nova validação na SERPRO, é necessário que a NF-e esteja válida no sistema deles.\"}]},{\"name\":\"paragraph\"},{\"name\":\"heading2\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"Entenda os erros que podem ser retornados pela api de upload de NF\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"1. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Invalid CNPJ. The access key CNPJ must be the same as the registration..\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Ocorre quando o CNPJ cadastrado em nosso sistema Shopee, não é o mesmo CNPJ emissor da nota fiscal que está sendo adicionada ao pedido. \"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Emitir a NF-e com o mesmo CNPJ cadastrado na Shopee; ou verificar o CNPJ cadastrado na Shopee e fazer as devidas correções.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"2. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Invalid UF. The access key UF must be the same as the registration..\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ocorre quando o estado do CNPJ emitente da nota fiscal não corresponde com o estado do seller cadastrado na Shopee.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Emitir a NF-e com o mesmo estado cadastrado na Shopee; ou verificar o estado cadastrado na Shopee e fazer as devidas correções.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"3. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Invalid State Registration Number. The NF-e State Registration Number must be the same as the registration..\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Ocorre quando a inscrição estadual do emitente da nota fiscal não corresponde com inscrição estadual do seller cadastrado na Shopee.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Emitir a NF-e com a mesma inscrição estadual cadastrada na Shopee; ou verificar a inscrição estadual cadastrada na Shopee e fazer as devidas correções.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"4. Error message:\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\" \\\"Wrong parameters, detail: Don't support Invoice Issuer now, please switch Shop Default to upload invoice..\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Ocorre quando o seller escolheu o emissor de NF Shopee. (Shopee Invoice Issuer) \"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Entrar na Central do Vendedor em \\\"Shop > Shop Profile > Invoice Setting > Edit > Other\\\"\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"5. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Invalid NF-e.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: NF-e não é válida.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Adicionar uma nota fiscal válida. Caso a NF-e seja válida mas acabou de ser gerada, aguarde 5 minutos para que adicione a chave de acesso novamente.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"6. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Canceled NF-e.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"NF-e cancelada.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Adicionar uma NF-e que não esteja cancelada.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"7. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Access Key duplicated, please do not use duplicated Access Key.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"NF-e já foi utilizada em outra order.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Adicionar uma NF-e que ainda não foi utilizada.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"8. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: access_key must be 44 characters in length.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Chave de acesso adicionada contém menos ou mais dígitos do que o da NF-e válida.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Verificar a chave de acesso se está corretamente com os 44 dígitos.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"9. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: access_key is a required field.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Request enviado sem a chave de acesso (access_key).\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Adicionar a chave de acesso no request da chamada.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"10. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Invalid issue date. The NF-e issue date cannot be greater than the current date..\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"A data de emissão da nota fiscal é maior que a data atual. Exemplo: data de emissão 20 de Agosto de 2022, data atual 18 de Agosto de 2022.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Adicionar uma NF-e com a data correta.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"11. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: The invoice status is invalid to upload invoice data.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" O pedido está atrelado a um parceiro logístico que não suporta NF-e (ex: Correios); ou o pedido já está cancelado.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Caso o pedido seja de um parceiro logístico que não suporta NF-e, basta organizar o envio da order através do endpoint v2.logistics.ship_order. Para pedidos cancelados, não tem correção.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"12. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: Invalid access key..\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Chave de acesso é inválida.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Subir uma chave de acesso válida. \"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"13. Error message: \\\"\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"Wrong parameters, detail: order_sn is a required field.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" Request sem o parâmetro order_sn.\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"transparent\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Adicionar o parâmetro order_sn na request.\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"14. Error message:\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"\\\"Invalid NF-e model. Only model 55 is accepted.\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo:\"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\" \\\"mod\\\" do XML enviado diferente de 55\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"gerar uma NF apenas com o mod 55\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"15. Error message:\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\"\\\"CFOP invalid, please confirm it\\\" \"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a. Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"CFOP não aceito pela Shopee\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"os únicos CFOPs válidos são \"},{\"data\":\"6108, 6102, 5102, 6107, 6101, 5101, 5405, 6404, 6403, 6106, 5403, 5106, 6104, 6109, 6115, 6103, 6105, 6401, 5115, 6120, 5103, 5105, 5104, 5109, 6402, 5120, 6118, 5401, 5402, 5112, 5114, 6112, 5117, 6117, 5118, 6113, 6114, 6119, 5111, 6123, 6116, 5116, 5119, 5113, 6111;\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"16. Error message:\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\" \\\"Please upload a valid Invoice XML file\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\". \"},{\"attributes\":{\"bold\":true},\"data\":\"Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Enviar um arquivo sem o formato correto do XML\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Enviar arquivo formato correto (como gerado pelo seu emissor);\"}]},{\"name\":\"paragraph\"},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"17. Error message:\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\" \\\"File Error\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"a\"},{\"attributes\":{\"bold\":true,\"italic\":true},\"data\":\". \"},{\"attributes\":{\"bold\":true},\"data\":\"Motivo: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Arquivo XML não contém a tag \\\"\"},{\"data\":\"<?xml version=“1.0” encoding=“UTF-8\\\"?>\\\"\"}]},{\"name\":\"paragraph\",\"children\":[{\"attributes\":{\"bold\":true},\"data\":\"b. Solução: \"},{\"attributes\":{\"fontBackgroundColor\":\"rgba(0,0,0,0)\",\"fontColor\":\"rgb(0,0,0)\"},\"data\":\"Inserir a tag mencionada acima no seu arquivo XML, ou enviar NF via Seller Center (vale ressaltar que essa validação não será mais necessária a partir de 1º de Abril de 2024),\"}]},{\"name\":\"paragraph\"}]",
  "content": "<p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Na Shopee, para vendedores CNPJ é necessário que seja adicionado a Nota Fiscal no pedido, exceto para pedidos com o parceiro logístico que não tem suporte a Nota Fiscal, como por exemplo o Correios.</span></p><p>&nbsp;</p><h2><strong>Dados Necessários do Comprador para Emissão de NF-e</strong></h2><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Os dados podem ser obtidos através do endpoint </span><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://open.shopee.com/documents/v2/v2.order.get_order_detail?module=94&amp;type=1\"><strong>v2.order.get_order_detail</strong></a><strong> </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">com os valores indicados no parâmetro \"response_optional_fields\". No entanto, para aprimorar nossas políticas de proteção de dados, desde o dia 28 de Dezembro, os dados serão mascarados conforme:</span></p><p>&nbsp;</p><p><strong>1. Vendedor CPF:</strong></p><ol><li><span style=\"background-color:transparent;color:rgb(0,0,0);\">Disponibilizado apenas o \"Endereço\" do comprador, para orders com status \"READY_TO_SHIP\", \"PROCESSED\" e \"RETURN/REFUND\" na API (\"TO_SHIP\" e ˜R/R˜ no Seller Center).</span></li><li><span style=\"background-color:transparent;color:rgb(0,0,0);\">\"Nome\", \"Número\" de \"telefone\" e \"CPF\" do Buyer não será disponibilizado em nenhum status da order, pois não é necessário;</span></li></ol><p>&nbsp;</p><p>&nbsp;</p><figure class=\"image\"><img src=\"https://down-br.img.susercontent.com/br-11134141-7r98o-lncwzappgq1b20\" alt=\"\"></figure><p>&nbsp;</p><p><strong>2. Sellers CNPJ:</strong></p><ol><li><span style=\"background-color:transparent;color:rgb(0,0,0);\">Disponibilizados “Nome”, “Endereço” e “CPF” do buyer para orders com status “INVOICE_PENDING”, “READY_TO_SHIP”, “PROCESSED” e “RETURN/REFUND˜ na API (“TO_SHIP” e “R/R” no Seller Center)</span></li><li><span style=\"background-color:transparent;color:rgb(0,0,0);\">O “telefone” do Buyer não será disponibilizado em nenhum status da order, pois não é necessário;</span></li></ol><p>&nbsp;</p><p>&nbsp;</p><figure class=\"image\"><img src=\"https://down-br.img.susercontent.com/br-11134141-7r98o-lncwzll7jtm18e\" alt=\"\"></figure><p>&nbsp;</p><p><span style=\"background-color:rgb(255,255,255);color:rgb(0,0,0);\">Essa nova regra não deve afetar os atuais fluxos da order pois os dados não são obrigatórios para nenhuma etapa do processo.</span></p><p>&nbsp;</p><h2><strong>Cálculo para Emissão de NF-e</strong></h2><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Os valores para emissão da NF podem ser obtidos através do endpoint </span><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://open.shopee.com/documents/v2/v2.payment.get_escrow_detail?module=97&amp;type=1\"><strong>v2.payment.get_scrow_detail</strong></a><span style=\"background-color:transparent;color:rgb(0,0,0);\"> como no cálculo abaixo:</span></p><p>&nbsp;</p><p><i><strong>Valor total da NF = \"original_price\" - \"seller_discount\" - \"discount_from_voucher_seller\" + \"buyer_paid_shipping_fee\"</strong></i></p><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Lembrando que isso é apenas uma das formas de calcular o valor da NF, caso seu time Fiscal apresente outra forma, não necessariamente estará incorreta.</span></p><p>&nbsp;</p><h2><span style=\"background-color:transparent;color:rgb(0,0,0);\">Verificando pedidos que precisam da NF-e</span></h2><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">1. Chamar o endpoint </span><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://open.shopee.com/documents/v2/v2.order.get_order_list?module=94&amp;type=1\"><strong>v2.order.get_order_list</strong></a><span style=\"background-color:transparent;color:rgb(0,0,0);\"> e passar o parâmetro opcional \"order_status\" com o valor \"INVOICE_PENDING\", dessa forma será retornado uma lista de pedidos que precisam ter a NF-e adicionada antes da organização de envio do pedido.</span></p><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ex de chamada em cURL:</span></p><p>&nbsp;</p><pre><code class=\"python hljs\">curl --location --request GET 'https://partner.shopeemobile.com/api/v2/order/get_order_list?partner_id=XXXX&amp;timestamp=XXXX&amp;access_token=XXXX&amp;shop_id=XXXX&amp;sign=XXXXXXXXXXXX&amp;time_range_field=XXXX&amp;time_from=XXXX&amp;time_to=XXXX&amp;page_size=100&amp;order_status=INVOICE_PENDING' \\\n\n--data-raw ''</code></pre><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ex de response:</span></p><p>&nbsp;</p><pre><code class=\"python hljs\">{\n\n\"error\":\"\",\n\n\"message\":\"\",\n\n\"response\":{\n\n\"more\":false,\n\n\"next_cursor\":\"\",\n\n\"order_list\":[\n\n{\n\n\"order_sn\":\"22002XXXXXXXX\"\n\n},\n\n{\n\n\"order_sn\":\"22003XXXXXXXX\"\n\n},\n\n{\n\n\"order_sn\":\"22001XXXXXXXX\"\n\n}\n\n]\n\n},\n\n\"request_id\":\"XXXXXXXX\"\n\n}</code></pre><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">2. Para verificar se a NF-e já está atrelada ao order_sn, basta utilizar o endpoint </span><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://open.shopee.com/documents/v2/v2.order.get_order_detail?module=94&amp;type=1\">v2.order.get_order_detail</a><span style=\"background-color:transparent;color:rgb(0,0,0);\">, com o parâmetro opcional: \"response_optional_fields\": \"invoice_data\" e a order_sn, dessa forma será retornado na response o objeto \"invoice_data\".&nbsp;</span></p><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ex de chamada em cURL:</span></p><p>&nbsp;</p><pre><code class=\"python hljs\">curl --location --request GET 'https://partner.shopeemobile.com/api/v2/order/get_order_detail?partner_id=XXXXX&amp;timestamp=XXXXX&amp;access_token=XXXXX&amp;shop_id=XXXXX&amp;sign=XXXXX&amp;order_sn_list=22002XXXXXXXX&amp;response_optional_fields=invoice_data' \\\n\n--header 'Content-Type: application/json' \\\n\n--data-raw ''</code></pre><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">a) Caso a order_sn já possua a invoice, então será retornado um objeto com os valores da NF-e.</span></p><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ex de response, order_sn com NF-e:</span></p><p>&nbsp;</p><pre><code class=\"python hljs\">{\n\n\"error\":\"\",\n\n\"message\":\"\",\n\n\"response\":{\n\n\"order_list\":[\n\n{\n\n\"cod\":false,\n\n\"create_time\":1662490093,\n\n\"currency\":\"BRL\",\n\n\"days_to_ship\":2,\n\n\"invoice_data\":{\n\n\"number\":\"000000XXX\",\n\n\"series_number\":\"00X\",\n\n\"access_key\":\"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\n\n\"issue_date\":1662492013,\n\n\"total_value\":100,\n\n\"products_total_value\":100,\n\n\"tax_code\":\"5101\"\n\n},\n\n\"message_to_seller\":\"\",\n\n\"order_sn\":\"22002XXXXXXXX\",\n\n\"order_status\":\"READY_TO_SHIP\",\n\n\"prescription_check_status\":null,\n\n\"region\":\"BR\",\n\n\"reverse_shipping_fee\":0,\n\n\"ship_by_date\":1662606000,\n\n\"update_time\":1662492365\n\n}\n\n]\n\n},\n\n\"request_id\":\"e631c3f1b4fe93a54a696a3229xxxxxx\"\n\n}</code></pre><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">b) Caso a order_sn ainda não possua a invoice, então será retornado um objeto vazio, uma vez que ainda não consta os valores da NF-e em nosso sistema.</span></p><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ex de response, order_sn sem NF-e:</span></p><p>&nbsp;</p><pre><code class=\"python hljs\">{\n\n\"error\":\"\",\n\n\"message\":\"\",\n\n\"response\":{\n\n\"order_list\":[\n\n{\n\n\"cod\":false,\n\n\"create_time\":1663009716,\n\n\"currency\":\"BRL\",\n\n\"days_to_ship\":2,\n\n\"invoice_data\":{},\n\n\"message_to_seller\":\"\",\n\n\"order_sn\":\"22002XXXXXXXX\",\n\n\"order_status\":\"READY_TO_SHIP\",\n\n\"prescription_check_status\":null,\n\n\"region\":\"BR\",\n\n\"reverse_shipping_fee\":0,\n\n\"ship_by_date\":0,\n\n\"update_time\":1663009855\n\n}\n\n]\n\n},\n\n\"request_id\":\"c8691da53612d1bc8ee5bb97dxxxxxx\"\n\n}</code></pre><p>&nbsp;</p><p><strong>⚠️ Nota</strong></p><ol><li><span style=\"background-color:transparent;color:rgb(0,0,0);\">O status do pedido retornado no v2.order.get_order_detail, não é alterado depois de chamar a API add_invoice_data, tanto as orders que ainda não possuem a NF-e adicionada, quanto as orders que já possuem a NF-e adicionadas, vão apresentar o \"order_status\":\"READY_TO_SHIP\". O status apenas é modificado na API v2.order.get_order_list, para o parâmetro de filtro (INVOICE_PENDING)</span></li></ol><p>&nbsp;</p><h2><strong>Adicionando o Invoice</strong></h2><p>&nbsp;</p><p>Com a order_sn no status INVOICE_PENDING, ou após validar se a order tem Invoice_data, então pode-se usar a seguinte API para upload de invoice:</p><p>&nbsp;</p><p>-<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://open.shopee.com/documents/v2/v2.order.upload_invoice_doc?module=94&amp;type=1\"><strong> v2.order.upload_invoice_doc</strong></a><span style=\"background-color:transparent;color:rgb(0,0,0);\"> para subir um arquivo XML, onde os parâmetros são:</span></p><ol><li><strong>order_sn:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> valor retornado na chamada anterior (v2.order.get_order_list)</span></li><li><strong>file_type: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">o tipo de arquivo, que para XML é “4”;</span></li><li><strong>file:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> que deve ser adicionado o caminho (ou “Path) do arquivo XML;</span></li></ol><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ex de chamada em cURL:</span></p><p>&nbsp;</p><pre><code class=\"python hljs\">curl --location 'https://partner.shopeemobile.com/api/v2/order/upload_invoice_doc?partner_id=XXXXXX&amp;timestamp=1682618933&amp;access_token=XXXXXXXXXXXXXXXX&amp;shop_id=XXXXXXX&amp;sign=XXXXXXXXXXXXXX’ \\\n\n--header 'Content-Type: application/json' \\\n\n--form 'file=@\"path/to/file\"' \\\n\n--form 'order_sn=\"2304278N5XXXXXXX\"' \\\n\n--form 'file_type=\"4\"</code></pre><p>&nbsp;</p><p><span style=\"background-color:transparent;color:rgb(0,0,0);\">Nota: Solicitamos que essa API seja chamada com um delay de 5 minutos após a criação da NF-e. Por conta&nbsp;da nova validação na SERPRO, é necessário que a NF-e esteja válida no sistema deles.</span></p><p>&nbsp;</p><h2><strong>Entenda os erros que podem ser retornados pela api de upload de NF</strong></h2><p>&nbsp;</p><p><strong>1. Error message: \"</strong><i><strong>Wrong parameters, detail: Invalid CNPJ. The access key CNPJ must be the same as the registration..\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Ocorre quando o CNPJ cadastrado em nosso sistema Shopee, não é o mesmo CNPJ emissor da nota fiscal que está sendo adicionada ao pedido.&nbsp;</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Emitir a NF-e com o mesmo CNPJ cadastrado na Shopee; ou verificar o CNPJ cadastrado na Shopee e fazer as devidas correções.</span></p><p>&nbsp;</p><p><strong>2. Error message: \"</strong><i><strong>Wrong parameters, detail: Invalid UF. The access key UF must be the same as the registration..\"</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ocorre quando o estado do CNPJ emitente da nota fiscal não corresponde com o estado do seller cadastrado na Shopee.</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Emitir a NF-e com o mesmo estado cadastrado na Shopee; ou verificar o estado cadastrado na Shopee e fazer as devidas correções.</span></p><p>&nbsp;</p><p><strong>3. Error message: \"</strong><i><strong>Wrong parameters, detail: Invalid State Registration Number. The NF-e State Registration Number must be the same as the registration..\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Ocorre quando a inscrição estadual do emitente da nota fiscal não corresponde com inscrição estadual do seller cadastrado na Shopee.</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Emitir a NF-e com a mesma inscrição estadual cadastrada na Shopee; ou verificar a inscrição estadual cadastrada na Shopee e fazer as devidas correções.</span></p><p>&nbsp;</p><p><strong>4. Error message:</strong><i><strong> \"Wrong parameters, detail: Don't support Invoice Issuer now, please switch Shop Default to upload invoice..\"</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Ocorre quando o seller escolheu o emissor de NF Shopee. (Shopee Invoice Issuer)&nbsp;</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Entrar na Central do Vendedor em \"Shop &gt; Shop Profile &gt; Invoice Setting &gt; Edit &gt; Other\"</span></p><p>&nbsp;</p><p><strong>5. Error message: \"</strong><i><strong>Wrong parameters, detail: Invalid NF-e.\"</strong></i></p><p><strong>a. Motivo: NF-e não é válida.</strong></p><p><strong>b. Solução: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Adicionar uma nota fiscal válida. Caso a NF-e seja válida mas acabou de ser gerada, aguarde 5 minutos para que adicione a chave de acesso novamente.</span></p><p>&nbsp;</p><p><strong>6. Error message: \"</strong><i><strong>Wrong parameters, detail: Canceled NF-e.\"</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">NF-e cancelada.</span></p><p><strong>b. Solução: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Adicionar uma NF-e que não esteja cancelada.</span></p><p>&nbsp;</p><p><strong>7. Error message: \"</strong><i><strong>Access Key duplicated, please do not use duplicated Access Key.\"</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">NF-e já foi utilizada em outra order.</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Adicionar uma NF-e que ainda não foi utilizada.</span></p><p>&nbsp;</p><p><strong>8. Error message: \"</strong><i><strong>Wrong parameters, detail: access_key must be 44 characters in length.\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Chave de acesso adicionada contém menos ou mais dígitos do que o da NF-e válida.</span></p><p><strong>b. Solução: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Verificar a chave de acesso se está corretamente com os 44 dígitos.</span></p><p>&nbsp;</p><p><strong>9. Error message: \"</strong><i><strong>Wrong parameters, detail: access_key is a required field.\"</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Request enviado sem a chave de acesso (access_key).</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Adicionar a chave de acesso no request da chamada.</span></p><p>&nbsp;</p><p><strong>10. Error message: \"</strong><i><strong>Wrong parameters, detail: Invalid issue date. The NF-e issue date cannot be greater than the current date..\"</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">A data de emissão da nota fiscal é maior que a data atual. Exemplo: data de emissão 20 de Agosto de 2022, data atual 18 de Agosto de 2022.</span></p><p><strong>b. Solução: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Adicionar uma NF-e com a data correta.</span></p><p>&nbsp;</p><p><strong>11. Error message: \"</strong><i><strong>Wrong parameters, detail: The invoice status is invalid to upload invoice data.\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> O pedido está atrelado a um parceiro logístico que não suporta NF-e (ex: Correios); ou o pedido já está cancelado.</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Caso o pedido seja de um parceiro logístico que não suporta NF-e, basta organizar o envio da order através do endpoint v2.logistics.ship_order. Para pedidos cancelados, não tem correção.</span></p><p>&nbsp;</p><p><strong>12. Error message: \"</strong><i><strong>Wrong parameters, detail: Invalid access key..\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Chave de acesso é inválida.</span></p><p><strong>b. Solução:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Subir uma chave de acesso válida.&nbsp;</span></p><p>&nbsp;</p><p><strong>13. Error message: \"</strong><i><strong>Wrong parameters, detail: order_sn is a required field.\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:transparent;color:rgb(0,0,0);\"> Request sem o parâmetro order_sn.</span></p><p><strong>b. Solução: </strong><span style=\"background-color:transparent;color:rgb(0,0,0);\">Adicionar o parâmetro order_sn na request.</span></p><p>&nbsp;</p><p><strong>14. Error message:</strong><i><strong>\"Invalid NF-e model. Only model 55 is accepted.\"</strong></i></p><p><strong>a. Motivo:</strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\"> \"mod\" do XML enviado diferente de 55</span></p><p><strong>b. Solução: </strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">gerar uma NF apenas com o mod 55</span></p><p>&nbsp;</p><p><strong>15. Error message:</strong><i><strong>\"CFOP invalid, please confirm it\"&nbsp;</strong></i></p><p><strong>a. Motivo: </strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">CFOP não aceito pela Shopee</span></p><p><strong>b. Solução: </strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">os únicos CFOPs válidos são </span>6108, 6102, 5102, 6107, 6101, 5101, 5405, 6404, 6403, 6106, 5403, 5106, 6104, 6109, 6115, 6103, 6105, 6401, 5115, 6120, 5103, 5105, 5104, 5109, 6402, 5120, 6118, 5401, 5402, 5112, 5114, 6112, 5117, 6117, 5118, 6113, 6114, 6119, 5111, 6123, 6116, 5116, 5119, 5113, 6111;</p><p>&nbsp;</p><p><strong>16. Error message:</strong><i><strong> \"Please upload a valid Invoice XML file\"</strong></i></p><p><strong>a</strong><i><strong>. </strong></i><strong>Motivo:&nbsp;</strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">Enviar um arquivo sem o formato correto do XML</span></p><p><strong>b. Solução: </strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">Enviar arquivo formato correto (como gerado pelo seu emissor);</span></p><p>&nbsp;</p><p><strong>17. Error message:</strong><i><strong> \"File Error\"</strong></i></p><p><strong>a</strong><i><strong>. </strong></i><strong>Motivo:&nbsp;</strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">Arquivo XML não contém a tag \"</span>&lt;?xml version=“1.0” encoding=“UTF-8\"?&gt;\"</p><p><strong>b. Solução: </strong><span style=\"background-color:rgba(0,0,0,0);color:rgb(0,0,0);\">Inserir a tag mencionada acima no seu arquivo XML, ou enviar NF via Seller Center (vale ressaltar que essa validação não será mais necessária a partir de 1º de Abril de 2024),</span></p><p>&nbsp;</p>",
  "status": 1,
  "language_code": "en",
  "language_list": [
    "en"
  ]
}