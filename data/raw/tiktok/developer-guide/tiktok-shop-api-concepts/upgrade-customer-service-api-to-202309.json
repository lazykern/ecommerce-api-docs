{
  "title": "Upgrade Customer Service API to 202309",
  "content": "# Mapping\n## Path mapping\n| **CS API v1.0 (old)** | **CS API v2.0 (new)** |\n| --- | --- |\n| [POST]/api/seller/im/send_message | [POST]/customer_service/202309/conversations/:conversation_id/messages |\n| [GET]/api/seller/im/customer_service/status | [GET]/customer_service/202309/agents/settings |\n| [POST]/api/seller/im/customer_service/status/update | [PUT]/customer_service/202309/agents/settings |\n| [POST]/api/seller/im/list_conversations | [GET]/customer_service/202309/conversations |\n| [POST]/api/seller/im/get_conversation_messages | [GET]/customer_service/202309/conversations/:conversation_id/messages |\n| [POST]/api/seller/im/img/upload | [POST]/customer_service/202309/images/upload |\n| [POST]/api/seller/im/mark_read | [POST]/customer_service/202309/conversations/:conversation_id/messages/read |\n| [POST]/api/seller/im/create_conversation | [POST]/customer_service/202309/conversations |\n## Field mapping\n### [POST]/api/seller/im/send_message\nNew path: [POST]/customer_service/202309/conversations/:conversation_id/messages\n#### Request param\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| conv_short_id | string | conversation_id | string | Move to path variable |\n| msg_type | string | type | string(enum) | Enum mapping: <br> text->TEXT <br> file_image->IMAGE <br> goods_card->PRODUCT_CARD <br> order_card->ORDER_CARD |\n| content | string | content | string | **text**: <br> old: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> new: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> **file_image**: <br> old: <br> { <br> \"imageHeight\": \"290\", <br> \"imageUrl\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"imageWidth\": \"304\" <br> } <br>  <br> new: <br> { <br> \"height\": 290, <br> \"url\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"width\": 304 <br> } <br>  <br> **goods_card**: <br> old: <br> { <br> \"goods_id\": \"7494560109732334267\" <br> } <br>  <br> new: <br> { <br> \"product_id\": \"7494560109732334267\" <br> } <br>  <br> **order_card**: <br> old: <br> { <br> \"order_id\": \"7494560109732334267\" <br> } <br>  <br> new: <br> { <br> \"order_id\": \"7494560109732334267\" <br> } |\n#### Response\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| msg_id | string | message_id | string |  |\n### [GET]/api/seller/im/customer_service/status\nNew path: [GET]/customer_service/202309/agents/settings\n#### Request param\nnone\n#### Response\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| status | int | can_accept_chat | bool | Value mapping: <br> 1->true <br> 0->false <br> 2->false <br>  <br> The old values 0 and 2 mean the customer service agent won't accept any chats. |\n### [POST]/api/seller/im/customer_service/status/update\nNew path: [PUT]/customer_service/202309/agents/settings\n#### Request param\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| status | int | can_accept_chat | bool | Value mapping: <br> 1->true <br> 0->false |\n#### Response\nNone\n### [POST]/api/seller/im/list_conversations\nNew path: [GET]/customer_service/202309/conversations\n#### Request\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| cursor | string | page_token | string |  |\n| limit | int | page_size | int |  |\n| language | string | locale | string |  |\n#### Response\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| next_cursor | string | next_page_token | string | 2 old fields are mixed to 1 new field. <br> An empty `page_token` means `has_more` is `false`. |\n| has_more | bool |  |  |  |\n| conv_with_last_msg | Object[] | conversations | Object[] |  |\n| conv_with_last_msg[].conv_info.conv_short_id | string | conversations[].id | string |  |\n| conv_with_last_msg[].conv_info.app_id | int | **Deleted** |  |  |\n| conv_with_last_msg[].conv_info.member_count | int | conversations[].participant_count | int |  |\n| conv_with_last_msg[].conv_info.can_send_message | bool | conversations[].can_send_message | bool |  |\n| conv_with_last_msg[].conv_info.unread_count | int | conversations[].unread_count | int |  |\n| conv_with_last_msg[].conv_info.participants | Object[] | conversations[].participants | Object[] |  |\n| conv_with_last_msg[].conv_info.participants[].participant_id | string | conversations[].participants[].im_user_id | string |  |\n| conv_with_last_msg[].conv_info.participants[].role | int | conversations[].participants[].role | string(enum) | Enum mapping: <br> 1->BUYER <br> 2->SHOP <br> 3->CUSTOMER_SERVICE |\n| conv_with_last_msg[].conv_info.participants[].nick | string | conversations[].participants[].nickname | string |  |\n| conv_with_last_msg[].conv_info.participants[].avatar | string | conversations[].participants[].avatar | string |  |\n| conv_with_last_msg[].conv_info.participants[].outer_id | string | conversations[].participants[].user_id | string |  |\n| conv_with_last_msg[].latest_msg | Object | conversations[].latest_message | Object |  |\n| conv_with_last_msg[].latest_msg.conv_short_id | string | **Deleted** |  |  |\n| conv_with_last_msg[].latest_msg.msg_id | string | conversations[].latest_message.id | string |  |\n| **Newly added** |  | conversations[].latest_message.sender | Object |  |\n| conv_with_last_msg[].latest_msg.sender_id | string | conversations[].latest_message.sender.im_user_id | string |  |\n| conv_with_last_msg[].latest_msg.sender_role | int | **Deleted** |  |  |\n| conv_with_last_msg[].latest_msg.sender_role_v2 | int | conversations[].latest_message.sender.role | string(enum) | Enum mapping: <br> 1->BUYER <br> 2->SHOP <br> 3->CUSTOMER_SERVICE <br> 4(deprecated) <br> 5->SYSTEM <br> 6->ROBOT |\n| conv_with_last_msg[].latest_msg.sender_nick | string | conversations[].latest_message.sender.nickname | string |  |\n| conv_with_last_msg[].latest_msg.sender_avatar | string | conversations[].latest_message.sender.avatar | string |  |\n| conv_with_last_msg[].latest_msg.ref_msg_info | Object | **Deleted** |  |  |\n| conv_with_last_msg[].latest_msg.msg_type | string(enum) | conversations[].latest_message.type | string(enum) | Enum mapping: <br> text->TEXT <br> file_image->IMAGE <br> allocated_service->ALLOCATED_SERVICE <br> notification->NOTIFICATION <br> use_enter_from_transfer->BUYER_ENTER_FROM_TRANSFER <br> user_enter_from_goods->BUYER_ENTER_FROM_PRODUCT <br> user_enter_from_order->BUYER_ENTER_FROM_ORDER <br> goods_card->PRODUCT_CARD <br> order_card->ORDER_CARD <br> emoticons->EMOTICONS <br> video->VIDEO <br> other->OTHER |\n| conv_with_last_msg[].latest_msg.content | string | conversations[].latest_message.content | string | **text, allocated_service, notification, user_enter_from_transfer**: <br> old: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> new: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> **file_image**: <br> old: <br> { <br> \"imageHeight\": \"290\", <br> \"imageUrl\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"imageWidth\": \"304\" <br> } <br>  <br> new: <br> { <br> \"height\": 290, <br> \"url\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"width\": 304 <br> } <br>  <br> **goods_card, user_enter_from_goods**: <br> old: <br> { <br> \"goods_id\": \"7494560109732334274\" <br> } <br>  <br> new: <br> { <br> \"product_id\": \"7494560109732334274\" <br> } <br>  <br> **order_card, user_enter_from_orders**: <br> old: <br> { <br> \"order_id\": \"7494560109732336829\" <br> } <br>  <br> new: <br> { <br> \"order_id\": \"7494560109732336829\" <br> } <br>  <br> **video**: <br> old: <br> { <br> \"video_info\": \"{\"videoUrl\":\"https://v16m-default.akamaized.net/f4d97c4ca9018602e423366c40e9ccec/660fc8a9/video/tos/alisg/tos-alisg-v-2ea863-sg/okIEwc9EIW4OAJyZTiBOc6iIoB4xf3YEoQA2Po\",\"coverUrl\":\"https://p16-oec-sg.ibyteimg.com/tos-alisg-v-2ea863-sg/oA29Bf4OciNoIyOEIAywiAToE6oBYbIZzAl4WF~tplv-aphluv4xwc-origin-jpeg.jpeg?from=3431008404\",\"videoWidth\":1920,\"videoHeight\":960,\"videoDuration\":127.254,\"vid\":\"v10394g5000ccnk3m7fog65o44qog4cg\",\"videoExpireTime\":1712310441,\"videoFormat\":\"mp4\",\"videoSize\":9309252,\"videoBitRate\":585239,\"videoQuality\":\"original\",\"codecType\":\"h264\",\"nonOriginal\":\"\"}\" <br> } <br>  <br> new: <br> { <br> \"url\": \"https://v16m-default.akamaized.net/f4d97c4ca9018602e423366c40e9ccec/660fc8a9/video/tos/alisg/tos-alisg-v-2ea863-sg/okIEwc9EIW4OAJyZTiBOc6iIoB4xf3YEoQA2Po\", <br> \"width\": 1920, <br> \"height\": 960, <br> \"duration\": \"127.254\", <br> \"vid\": \"v10394g5000ccnk3m7fog65o44qog4cg\", <br> \"expire_time\": 1712310441, <br> \"format\": \"mp4\", <br> \"size\": 9309252, <br> \"bit_rate\": 585239, <br> \"quality\": \"original\", <br> \"codec_type\": \"h264\" <br> } |\n| conv_with_last_msg[].latest_msg.index_in_conversation | string | **Deleted** |  |  |\n| conv_with_last_msg[].latest_msg.is_visible | bool | conversations[].latest_message.is_visible | bool |  |\n| conv_with_last_msg[].latest_msg.create_time | int | conversations[].latest_message.create_time | int |  |\n### [POST]/api/seller/im/get_conversation_messages\nNew path: [GET]/customer_service/202309/conversations/:conversation_id/messages\n#### Request param\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| conv_short_id | string | conversation_id | string | Move to path variable |\n| pull_direction | int | sort_order | string(enum) | Enum mapping: <br> 0->ASC <br> 1->DESC <br>  <br> In the old API, messages will always be sorted from oldest to latest. <br> In the new API, messages will be sorted from oldest to latest if the \"sort_order\" is \"ASC\", while they will be sorted from latest to oldest if \"sort_order\" is \"DESC\". |\n| **Newly added** |  | sort_field | string | Sort messages by <br> Available value: <br> create_time (default) |\n| cursor | string | page_token | string |  |\n| limit | int | page_size | int |  |\n| language | string | locale | string |  |\n#### Response\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| next_cursor | string | next_page_token | string | 2 old fields are mixed to 1 new field. <br> An empty `page_token` means `has_more` is `false`. |\n| has_more | bool |  |  |  |\n| unsupport_msg_tips | string | unsupported_msg_tips | string |  |\n| msgs | Object[] | messages | Object[] |  |\n| msgs[].conv_short_id | string | **Deleted** |  |  |\n| msgs[].msg_id | string | messages[].id | string |  |\n| **Newly added** |  | messages[].sender | Object |  |\n| msgs[].sender_id | string | messages[].sender.im_user_id | string |  |\n| msgs[].sender_role | int | **Deleted** |  |  |\n| msgs[].sender_role_v2 | int | messages[].sender.role | string(enum) | Enum mapping: <br> 1->BUYER <br> 2->SHOP <br> 3->CUSTOMER_SERVICE <br> 4(deprecated) <br> 5->SYSTEM <br> 6->ROBOT |\n| msgs[].sender_nick | string | messages[].sender.nickname | string |  |\n| msgs[].sender_avatar | string | messages[].sender.avatar | string |  |\n| msgs[].ref_msg_info | Object | **Deleted** |  |  |\n| msgs[].msg_type | string(enum) | messages[].type | string(enum) | Enum mapping: <br> text->TEXT <br> file_image->IMAGE <br> allocated_service->ALLOCATED_SERVICE <br> notification->NOTIFICATION <br> use_enter_from_transfer->BUYER_ENTER_FROM_TRANSFER <br> user_enter_from_goods->BUYER_ENTER_FROM_PRODUCT <br> user_enter_from_order->BUYER_ENTER_FROM_ORDER <br> goods_card->PRODUCT_CARD <br> order_card->ORDER_CARD <br> emoticons->EMOTICONS <br> video->VIDEO <br> other->OTHER |\n| msgs[].content | string | messages[].content | string | **text, allocated_service, notification, user_enter_from_transfer**: <br> old: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> new: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> **file_image**: <br> old: <br> { <br> \"imageHeight\": \"290\", <br> \"imageUrl\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"imageWidth\": \"304\" <br> } <br>  <br> new: <br> { <br> \"height\": 290, <br> \"url\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"width\": 304 <br> } <br>  <br> **goods_card, user_enter_from_goods**: <br> old: <br> { <br> \"goods_id\": \"7494560175032334583\" <br> } <br>  <br> new: <br> { <br> \"product_id\": \"7494560175032334583\" <br> } <br>  <br> **order_card, user_enter_from_orders**: <br> old: <br> { <br> \"order_id\": \"7494560109732337395\" <br> } <br>  <br> new: <br> { <br> \"order_id\": \"7494560109732337395\" <br> } <br>  <br> **video**: <br> old: <br> { <br> \"video_info\": \"{\"videoUrl\":\"https://v16m-default.akamaized.net/f4d97c4ca9018602e423366c40e9ccec/660fc8a9/video/tos/alisg/tos-alisg-v-2ea863-sg/okIEwc9EIW4OAJyZTiBOc6iIoB4xf3YEoQA2Po\",\"coverUrl\":\"https://p16-oec-sg.ibyteimg.com/tos-alisg-v-2ea863-sg/oA29Bf4OciNoIyOEIAywiAToE6oBYbIZzAl4WF~tplv-aphluv4xwc-origin-jpeg.jpeg?from=3431008404\",\"videoWidth\":1920,\"videoHeight\":960,\"videoDuration\":127.254,\"vid\":\"v10394g5000ccnk3m7fog65o44qog4cg\",\"videoExpireTime\":1712310441,\"videoFormat\":\"mp4\",\"videoSize\":9309252,\"videoBitRate\":585239,\"videoQuality\":\"original\",\"codecType\":\"h264\",\"nonOriginal\":\"\"}\" <br> } <br>  <br> new: <br> { <br> \"url\": \"https://v16m-default.akamaized.net/f4d97c4ca9018602e423366c40e9ccec/660fc8a9/video/tos/alisg/tos-alisg-v-2ea863-sg/okIEwc9EIW4OAJyZTiBOc6iIoB4xf3YEoQA2Po\", <br> \"width\": 1920, <br> \"height\": 960, <br> \"duration\": \"127.254\", <br> \"vid\": \"v10394g5000ccnk3m7fog65o44qog4cg\", <br> \"expire_time\": 1712310441, <br> \"format\": \"mp4\", <br> \"size\": 9309252, <br> \"bit_rate\": 585239, <br> \"quality\": \"original\", <br> \"codec_type\": \"h264\" <br> } |\n| msgs[].index_in_conversation | string | **Deleted** |  |  |\n| msgs[].is_visible | bool | messages[].is_visible | bool |  |\n| msgs[].create_time | int | messages[].create_time | int |  |\n### [POST]/api/seller/im/img/upload\nNew path: [POST]/customer_service/202309/images/upload\n#### Request param\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| data | string | data | binary | In the old API, you should encode your image into BASE64 string, then put it in to a JSON request body. <br>  <br> In the new API, you should put your image binary data into the request body, with \"Content-Type=multipart/form-data\" and a form key named \"data\". |\n#### Response\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| url | string | url | string |  |\n| width | int | width | int |  |\n| height | int | height | int |  |\n### [POST]/api/seller/im/mark_read\nNew path: [POST]/customer_service/202309/conversations/:conversation_id/messages/read\n#### Request param\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| conv_short_id | string | conversation_id | string | Move to path variable. |\n#### Response\nNone\n### [POST]/api/seller/im/create_conversation\nNew path: [POST]/customer_service/202309/conversations\n#### Request param\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| buyer_id | string | buyer_user_id | string |  |\n#### Response\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| conv_short_id | string | conversation_id | string |  |\n## Webhook\n### Type mapping\n| **Event** | **Old type** | **New type** |\n| --- | --- | --- |\n| New conversation | 8 | 13 |\n| New messages | 9 | 14 |\n### Field mapping\n#### New Conversation\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| conv_short_id | string | conversation_id | string |  |\n| create_time | int | create_time | int |  |\n#### New Messages\n| **Old** | **Old type** | **New** | **New type** | **Description** |\n| --- | --- | --- | --- | --- |\n| message_id | string | message_id | string |  |\n| conv_short_id | string | conversation_id | string |  |\n| content | string | content | string | **text, allocated_service, notification, user_enter_from_transfer**: <br> old: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> new: <br> { <br> \"content\": \"simple text\" <br> } <br>  <br> **file_image**: <br> old: <br> { <br> \"imageHeight\": \"290\", <br> \"imageUrl\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"imageWidth\": \"304\" <br> } <br>  <br> new: <br> { <br> \"height\": 290, <br> \"url\": \"https://tosv.boei18n.byted.org/obj/temai-im/FszkJ53nSapYG6KDaJQmqR3jjoZGwww304-290\", <br> \"width\": 304 <br> } <br>  <br> **goods_card, user_enter_from_goods**: <br> old: <br> { <br> \"goods_id\": \"7494560175032334583\" <br> } <br>  <br> new: <br> { <br> \"product_id\": \"7494560175032334583\" <br> } <br>  <br> **order_card, user_enter_from_orders**: <br> old: <br> { <br> \"order_id\": \"7494560109732337395\" <br> } <br>  <br> new: <br> { <br> \"order_id\": \"7494560109732337395\" <br> } <br>  <br> **video**: <br> old: <br> { <br> \"video_info\": \"{\"videoUrl\":\"https://v16m-default.akamaized.net/f4d97c4ca9018602e423366c40e9ccec/660fc8a9/video/tos/alisg/tos-alisg-v-2ea863-sg/okIEwc9EIW4OAJyZTiBOc6iIoB4xf3YEoQA2Po\",\"coverUrl\":\"https://p16-oec-sg.ibyteimg.com/tos-alisg-v-2ea863-sg/oA29Bf4OciNoIyOEIAywiAToE6oBYbIZzAl4WF~tplv-aphluv4xwc-origin-jpeg.jpeg?from=3431008404\",\"videoWidth\":1920,\"videoHeight\":960,\"videoDuration\":127.254,\"vid\":\"v10394g5000ccnk3m7fog65o44qog4cg\",\"videoExpireTime\":1712310441,\"videoFormat\":\"mp4\",\"videoSize\":9309252,\"videoBitRate\":585239,\"videoQuality\":\"original\",\"codecType\":\"h264\",\"nonOriginal\":\"\"}\" <br> } <br>  <br> new: <br> { <br> \"url\": \"https://v16m-default.akamaized.net/f4d97c4ca9018602e423366c40e9ccec/660fc8a9/video/tos/alisg/tos-alisg-v-2ea863-sg/okIEwc9EIW4OAJyZTiBOc6iIoB4xf3YEoQA2Po\", <br> \"width\": 1920, <br> \"height\": 960, <br> \"duration\": \"127.254\", <br> \"vid\": \"v10394g5000ccnk3m7fog65o44qog4cg\", <br> \"expire_time\": 1712310441, <br> \"format\": \"mp4\", <br> \"size\": 9309252, <br> \"bit_rate\": 585239, <br> \"quality\": \"original\", <br> \"codec_type\": \"h264\" <br> } |\n| is_visible | bool | is_visible | bool |  |\n| msg_type | string | type | string(enum) | Enum mapping: <br> text->TEXT <br> file_image->IMAGE <br> allocated_service->ALLOCATED_SERVICE <br> notification->NOTIFICATION <br> use_enter_from_transfer->BUYER_ENTER_FROM_TRANSFER <br> user_enter_from_goods->BUYER_ENTER_FROM_PRODUCT <br> user_enter_from_order->BUYER_ENTER_FROM_ORDER <br> goods_card->PRODUCT_CARD <br> order_card->ORDER_CARD <br> emoticons->EMOTICONS <br> video->VIDEO <br> other->OTHER |\n| **Newly added** |  | sender | Object |  |\n| sender_id | string | sender.im_user_id | string |  |\n| sender_role | int | **Deleted** |  |  |\n| sender_role_v2 | int | sender.role | string(enum) | Enum mapping: <br> 1->BUYER <br> 2->SHOP <br> 3->CUSTOMER_SERVICE <br> 4(deprecated) <br> 5->SYSTEM <br> 6->ROBOT |\n| create_time | int | create_time | int |  |\n\n",
  "update_time": "1751449585",
  "view_count": 0,
  "prev_document_id": "64f198f74830a5028854c106",
  "prev_document_path": "upgrading-to-api-version-202309",
  "next_document_id": "64f199a2dc7f3e028d383538",
  "next_document_path": "seller-center-development-shops",
  "is_api_doc": false,
  "document_id": "65fbdeee8a2f9402c86a0c3c",
  "doc_type": 2,
  "keywords": [
    {
      "keyword": "",
      "font_color": "#141414",
      "background_color": "#E6E6E6"
    }
  ]
}