{
  "title": "Widget SDK user guide",
  "content": "# Widget SDK Update instructions\nThis article documents the changes to the <**Widget**> SDK.\n## @tiktokshop/widget-kit\nFor native js integration\n### <Version 1.0.2>\nRelease date:2024/2/19\nFixed some issues.\n### <Version 1.0.0>\n### Added\n| **modules** | **description** |\n| --- | --- |\n| init | Added init method to support user integration and initial widgets. |\n| loadWidget | Added loadWidget method to support users loading our widget page. |\n| update | Added update method to support users to modify widget config. |\n| preloadWidget | Added preloadWidget method to support users to preload widget resources. |\n## @tiktokshop/widget-kit-react\nFor React component integration\n### <Version 1.0.2>\nRelease date:2024/2/19\n### Added\n| **modules** | **description** |\n| --- | --- |\n| WidgetConfigProvider | Added WidgetConfigProvider component, the component integrates the original init, update, preload methods, WidgetConfigProvider should be used with RemoteWidget, it is recommended to use WidgetConfigProvider in the react integration scenario instead of directly calling init, update, preload. |\n| RemoteWidget | Added RemoteWidget component. The original loadWidget method is integrated inside the component. Load state placeholder map and abnormal state placeholder map are provided. Users can specify widgets, load resources and render components by name. RemoteWidget should be used with WidgetConfigProvider. It is recommended to use RemoteWidget in the react integration scenario instead of calling loadWidget directly. |\n### <Version 1.0.0>\n### Added\n| **modules** | **description** |\n| --- | --- |\n| init | Added init method to support user integration and initial widgets. |\n| loadWidget | Added loadWidget method to support users loading our widget page. |\n| update | Added update method to support users to modify widget config. |\n| preloadWidget | Added preloadWidget method to support users to preload widget resources. |\n# Quick start\n## Configure development environment\n### Frame adaptation\nWe support two methods of react framework integration and native js integration. Users using the react framework can use the react component method to integrate, and non-react framework users can use the native JS method to integrate.\n### Install dependencies\nTo use react component integration, please install the following packages:\n```JSON\nnpm install @tiktokshop/widget-kit-react\n```\n\nFor native js integration, please install the following packages:\n```JSON\nnpm install @tiktokshop/widget-kit\n```\n\n## Integrated SDK\n### Preconditions\n\n* The server needs to develop an API for obtaining short-lived tokens (refer to document [Get Widget Token](get-widget-token) for development methods). When the front-end integrates the widget page, during the initialization SDK phase, the getWidgetToken field is passed into the function to obtain the token.\n* For security reasons, there are cross-origin restrictions on the interfaces in the widget page. When integrating the widget, you need to provide the domain name to the open platform for whitelist configuration.\n\n### Init widget\nreact framework uses (recommended):\nIt is recommended to put `WidgetConfigProvider` in the outermost layer of the entire application for global unified configuration\n```TypeScript\nimport { WidgetConfigProvider } from '@tiktokshop/widget-kit-react';\n\nconst initOptions =  {\n    config:{\n      shopId: 'xxx', //seller id, such as 123456\n      oecRegion: 'xxx',//country,such as US\n      appKey: 'xxx',//The key corresponding to the merchant's creation service\n      isvInfo: {\n        name: 'xxx',//ISV name,such as OPEN_PLATFORM\n      },\n    },\n    getToken:getWidgetToken,\n    // If you integrate multiple widgets, remotes can set multiple\n    remotes:[\n    {\n      name: 'xxx',//Integrated business name, provided by the open platform,such as:@tiktokshop-widget/product:optimizer\n    },\n  ]\n};\n\nexport default () => {\n  return (\n    <WidgetConfigProvider\n        config={initOptions.config} \n        getToken={initOptions.getToken} \n        remotes={initOptions.remotes}\n        preloadWidgetNames={['@tiktokshop-widget/product:optimizer']} \n    >\n      <RemoteWidget \n        name={'@tiktokshop-widget/product:optimizer'} \n        className={'containerClass'} \n        options={{}}\n      />\n    </WidgetConfigProvider>\n  );\n};\n```\n\nnative JS uses:\n```TypeScript\nimport { init } from '@tiktokshop/widget-kit';\n\ninit({\n  config: {\n      shopId: 'xxx', //seller id, such as 123456\n      oecRegion: 'xxx',//country,such as US\n      appKey: 'xxx',//The key corresponding to the merchant's creation service\n      isvInfo: {\n        name: 'xxx',//ISV name,such as OPEN_PLATFORM\n      },\n    },\n  remotes: [\n    {\n      name: 'xxx',//Integrated business name, provided by the open platform,such as:@tiktokshop-widget/product:optimizer\n    },\n  ],\n  getToken: getWidgetToken,//get auth token\n});\n```\n\n### Preload widget\nIf the widget page is not displayed on the first screen, the resources can be loaded in advance by preloading, which can reduce the loading time of subsequent components and improve the page response speed.\nreact framework uses:\nConfigure preload in `WidgetConfigProvider` preloadWidgetNames, you can put `WidgetConfigProvider` to the outermost preload time\n```JSON\n// For react component integration\nimport { preloadWidget } from '@tiktokshop/widget-kit-react';\n\nexport default () => {\n  return (\n    <WidgetConfigProvider\n        config={initOptions.config} \n        getToken={initOptions.getToken} \n        remotes={initOptions.remotes}\n        preloadWidgetNames={['@tiktokshop-widget/product:optimizer']} \n    >\n      <RemoteWidget \n        name={'@tiktokshop-widget/product:optimizer'} \n        className={'containerClass'} \n        options={{}}\n      />\n    </WidgetConfigProvider>\n  );\n};\n```\n\nnative JS uses:\nPreloading with `preloadWidget`\n```JSON\n// For native js integration\nimport { preloadWidget } from '@tiktokshop/widget-kit';//Reference method depends on the selected integration scheme\n\npreloadWidget(['@tiktokshop-widget/product:optimizer']);\n```\n\n### Load widget\nreact framework uses:\n```JavaScript\nimport { RemoteWidget } from \"@tiktokshop/widget-kit-react\";\n\nconst name = \"@tiktokshop-widget/product:optimizer\";\n\nexport function Test() {\n  return <RemoteWidget \n      name={name} \n      className={'widget-preview-container'} \n      options={{}}\n    />;\n}\n```\n\nnative JS uses:\n```JSON\nimport { loadWidget, WidgetComponent } from '@tiktokshop/widget-kit';\n\n//load widget\nconst name = '@tiktokshop-widget/product:optimizer';\nlet view = null;\nloadWidget(name).then((component: WidgetComponent) => {\n  view = component.create(\n    document.getElementById('widget-preview-container')!,\n  );\n  view?.render({});\n});\n\n//create a mount element\n<div\n  className=\"widget-preview-container\"\n  id=\"widget-preview-container\">\n</div>\n```\n\n### Update widget config\nWhen the merchant's shop information needs to be modified, the shop and other information can be updated by using the update method.\nreact framework uses:\nUpdate WidgetConfigProvider parameters to update widget configuration\nnative JS uses:\n```JSON\n\nimport { update } from '@tiktokshop/widget-kit';//Reference method depends on the selected integration scheme\n\nupdate({\n  config: {\n      shopId: 'xxx', //seller id, such as 123456\n      oecRegion: 'xxx',//country,such as US\n      appKey: 'xxx',//The key corresponding to the merchant's creation service\n      isvInfo: {\n        name: 'xxx',//ISV name,such as OPEN_PLATFORM\n      },\n    },\n  getToken: getWidgetToken,//get auth token\n});\n```\n\n# Reference API\n\n### Input Parameters\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| config | Object | Y |  | basic config of widget |\n| shopId | string | Y | '123456' | seller id, used for event tracking |\n| oecRegion | string | Y | 'US' | seller region, fill in the standard code of the country where the merchant is located, such as 'US', 'GB', and so on. |\n| appKey | string | Y | 'xxxxx' | authorized by the service market, used for authentication |\n| isvInfo | Object | Y |  | ISV related information |\n| name | string | Y | 'xxxxx' | the name of ISV |\n| getToken | Promise | Y |  | promise method to get token |\n| token | string | Y | 'eyJhbGciOiJIUzUxMxxxxxxxx' | token |\n| expire_at | string | Y | '1703227531' | expiration |\n| remotes | []Object | Y |  |  |\n| name | string | Y | '@tiktokshop-widget/product:optimizer' | Integrated widget name, provided by the open platform |\n\nThe output parameters of loadWidget in @tiktokshop/widget-kit-react and @tiktokshop/widget-kit are different. The specific differences are as follows:\n### @tiktokshop/widget-kit-react\n#### Input Parameters\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| name | string | Y | '@tiktokshop-widget/product:optimizer' | Integrated widget name, provided by the open platform |\n#### Output Parameters\n| Properties | Type | Sample |\n| --- | --- | --- |\n| Component <br> (custom name) | React.ComponentType | `JSON <br> const Component = loadWidget(name); <br> return ( <br> <div> <br> <Component /> <br> </div> <br> ); <br>` |\n### @tiktokshop/widget-kit\n#### Input Parameters\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| name | string | Y | '@tiktokshop-widget/product:optimizer' | Integrated widget name, provided by the open platform |\n#### Output Parameters\n| Properties | Type | Sample |\n| --- | --- | --- |\n| component <br> (custom name) | Promise | `JSON <br> loadWidget(name).then((component: WidgetComponent) => { <br> view = component.create( <br> document.getElementById('widget-preview-container'), <br> ); <br> view?.render({}); <br> }); <br> <br> return ( <br> <div <br> className=\"widget-preview-container\" <br> id=\"widget-preview-container\"></div> <br> ); <br>` |\n| create | (el: HTMLElement) => WidgetView |  |\n| render | (props: Record<string, any>) => Promise |  |\n| unmount() | Promise |  |\n| update | (props: Record<string, any>) => Promise |  |\n\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| name | string | Y | '@tiktokshop-widget/product:optimizer' | Integrated widget name, provided by the open platform |\n\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| config | Object | N |  | basic config of widget |\n| shopId | string | Y | '123456' | seller id, used for event tracking |\n| oecRegion | string | Y | 'US' | seller region, used for traffic scheduling |\n| appKey | string | Y | 'xxxxx' | authorized by the service market, used for authentication |\n| isvInfo | Object | Y |  | ISV related information |\n| name | string | Y | 'OPEN_PLATFORM' | the name of ISV |\n| getToken | Promise | N |  | promise method to get token |\n| token | string | Y | 'eyJhbGciOiJIUzUxMxxxxxxxx' | token |\n| expire_at | string | Y | '1703227531' | expiration |\n\nWidgetConfigProvider only exists in @tiktokshop/widget-kit-react\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| config | Object | Y |  | basic config of widget |\n| shopId | string | Y | '123456' | seller id, used for event tracking |\n| oecRegion | string | Y | 'US' | seller region, fill in the standard code of the country where the merchant is located, such as 'US', 'GB', 'ID', and so on. |\n| appKey | string | Y | 'xxxxx' | authorized by the service market, used for authentication |\n| isvInfo | Object | Y |  | ISV related information |\n| name | string | Y | 'xxxxx' | the name of ISV |\n| getToken | Promise | Y |  | promise method to get token |\n| token | string | Y | 'eyJhbGciOiJIUzUxMxxxxxxxx' | token |\n| expire_at | string | Y | '1703227531' | expiration |\n| remotes | []Object | Y |  |  |\n| name | string | Y | '@tiktokshop-widget/product:optimizer' | Integrated widget name, provided by the open platform |\n| preloadWidgetNames | string[] | N | ['@tiktokshop-widget/product:optimizer'] | Integrated widget name, provided by the open platform |\n\nRemoteWidget only exists in @tiktokshop/widget-kit-react\n| Properties | Type | Require | Sample | Properties description |\n| --- | --- | --- | --- | --- |\n| name | string | Y | '@tiktokshop-widget/product:optimizer' | Integrated widget name, provided by the open platform |\n| className | string | N | '' | dom node's classname |\n| style | CSSProperties | N | `JSON <br> { <br> \"width\":100 <br> } <br>` | dom node's style |\n| options | Record<string,any> | N |  | Configuration of incoming widget components |\n\n```JSON\nexport interface WidgetComponent {\n  create: (el: HTMLElement) => WidgetView;\n}\n```\n\n\n```JSON\nexport interface WidgetView {\n  render: (props: Record<string, any>) => Promise<void>;\n  unmount(): Promise<void>;\n  update: (props: Record<string, any>) => Promise<void>;\n}\n```\n\n# Error message list\n| **Error message** | **description** |\n| --- | --- |\n| Please call init first | You need to initialize [init](https://bytedance.larkoffice.com/docx/VmDKdqmlCokkwcx5srecegJongc#doxcnZJv54tgHadJdfTbSydf4nc) first before using it |\n| Current name configuration not found | Incorrect resource loading, please check if the resource is abnormal |\n|  |  |\n# FAQ\nIf you encounter problems while using the SDK, you can refer to this document to solve them.\n\n1. The widget page fails to load, and the interface for obtaining the token repeatedly initiates a request.\n\n<div style=\"text-align: center\"><img src=\"https://p16-arcosite-va.ibyteimg.com/tos-maliva-i-10qhjjqwgv-us/48565dbe760d4a4783c023756b8bc146~tplv-10qhjjqwgv-image.image\" width=\"1116px\" /></div>\n\nsolution: Check the return value and parameters of the interface /api/v1/seller/widget/get, usually because the token is not passed in. Check the return value of getToken in the code and ensure that the following data is returned.\n<div style=\"text-align: center\"><img src=\"https://p16-arcosite-va.ibyteimg.com/tos-maliva-i-10qhjjqwgv-us/e51e5883f9ab45eabb29dc106e834b50~tplv-10qhjjqwgv-image.image\" width=\"1284px\" /></div>\n\n```SQL\nif (res?.code === 0) {\n      return res?.data;//The token interfaces of different access parties return different data structures, and the ways of obtaining data are different here.\n    }\n```\n\n\n2. Interface/api/v1/seller/widget/get error list\n\n| error code | error message | reason |\n| --- | --- | --- |\n| 36017010 | Widget domain not match | The domain name configured in the whitelist does not match the actual one. |\n| 36017005 | Widget Token Is Expired | The widget token has expired |\n| 36017006 | Widget token is invalid | The widget token was sent incorrectly |\n| 36017008 | app_key is not match | app_key is not match |\n| 36017009 | Widget Token Shop Not Match | Your input shopid is not consistent with the shop info in widget. |\n| 36004003 | invalid client_key | Appkey whitelist is not configured. You need to provide the domain name and appKey to the open platform and configure the whitelist. |\n| I01008 | Traffic is invalid | The shop region is not matched with server room. In most cases, it was caused by unmatched shop_id and region. |\n\n3. The error is reported as follows\n\n<div style=\"text-align: center\"><img src=\"https://p16-arcosite-va.ibyteimg.com/tos-maliva-i-10qhjjqwgv-us/fcd2300daa394c109f177c97f0d291b2~tplv-10qhjjqwgv-image.image\" width=\"720px\" /></div>\n\nSolution: The widget name is wrong, please refer to the integration documentation to check again.\n\n",
  "update_time": "1751449895",
  "view_count": 0,
  "prev_document_id": "66696faaeeec1d02c84fa35c",
  "prev_document_path": "get-widget-token",
  "next_document_id": "66599ca675ead002e4e0c3fb",
  "next_document_path": "warehouse-settings",
  "is_api_doc": false,
  "document_id": "66723a3a0743dd02de7c72d4",
  "doc_type": 2,
  "keywords": [
    {
      "keyword": "",
      "font_color": "#141414",
      "background_color": "#E6E6E6"
    }
  ]
}