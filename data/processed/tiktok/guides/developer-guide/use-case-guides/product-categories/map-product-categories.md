# Map product categories to TikTok Shop product categories
A core scenario for TikTok Shop API developers is to allow the sellers on their application or service to select a TikTok Shop product category when adding a product to TikTok Shop.
When your seller adds a new product or updates an existing product by listing it on their TikTok Shop store, a TikTok Shop category must be provided as part of the create product API.
If you haven't already, [retrieve and store TikTok Shop product categories locally](store-product-categories). The example use cases below both assume that you've already done this so we recommend you do this first.
## Automated TikTok Shop category mapping
There's a few things to consider if you want to automate product category mapping between your application or service and TikTok Shop.
First, consider the scope of products for which you'll be mapping product categories. Do you want to map your entire product catalog, or just the products for a single seller? If mapping your entire product catalog, you'll use the same TikTok Shop credential, an **access token**, for all calls to the `POST recommend category` API. In this case, you should consider signing up for a test TikTok Shop, then authorizing your own TikTok Shop application to generate an **access token**.
If you're mapping just the products for a specific seller, you can use that seller's **access token**.
Regardless of which of these use cases you implement, both require that you use the `POST recommend category` API. This API requires two parameters: a product title, and at least one TikTok Shop product image URI. This is why both of the call flow diagrams and descriptions below include using the `POST upload product image` API, as this API is the only method to generate the required TikTok Shop product image URI.
![Image](https://sf16-sg.tiktokcdn.com/obj/eden-sg/jvK_ylwvslclK_JWZ%5B%5B/ljhwZthlaukjlkulzlp/Integration%20Guides/cat-pre-prereq-1.png)
The following call flow demonstrates how to map the TikTok Shop category for a single product. If you're mapping your entire product catalog, you'll iterate through your product list and execute the call flow for each product.
The call flow for automated TikTok Shop category mapping is:

1. Retrieve the locally stored product metadata. This assumes that you store your product metadata in a `product data table` that includes columns for a unique product identifier `productId`, a product name or title `name` an identifier `localCategoryId` that's an index into another table that stores your local product category metadata, and an identifier `imageId` that's an index into another table that stores your local product image metadata. For this use case, we'll be working with `name`, `localCategoryId`, and `imageId`.
2. Retrieve the product image URL for the related image data using the `imageId` you retrieved in step 1. This assumes that you have a `product image mapping data table` or similar data store that includes columns for a unique image identifier `imageId`, a file name `fileName`, an identifier that's an index into another table that stores product image data `localImageId`, and an identifier that's an index into another table that store TikTok Shop product image data `TikTokShopImageId`. Note that this field is set to `null` in this example to indicate that we haven't yet uploaded the product image to TikTok Shop, but we'll do that in the next steps below.
3. Retrieve the local image data using the `localImageId` that you retrieved in step 2. This assumes that you have a `local image data table` or similar data store that includes columns for a unique local image identifier `localImageId` and a URL `localImageUrl` where the local image data can be retrieved over HTTP. This assumes that you're storing your image files on an HTTP server. If you're not storing your image files on an HTTP server, the `localImageUrl` field can be a reference to the file in whatever file storage system you're using. You will need to adjust step 4 below if this is the case.
4. Retrieve the product image file data using the programming language and functionality of your choice. In this example, it's shown in NodeJS using the `fetch` function to retrieve a `blob`. This is because the product image file data will be sent to the `POST upload product image` API as `multipart/form-data`. If you're using a different programming language, you'll use that language's HTTP libraries for `multipart/form-data`.
5. Call the `POST upload product image` API using the product image file data `blob` that you created in step 4.
6. If successful, the `200` response includes a `data` object with a `uri` property that's a unique identifier of the image in the TikTok Shop CDN, and a `url` property that includes the URL to retrieve the product image file from the TikTok Shop CDN.
7. Generate a new unique identifier for the TikTok Shop product image data. In this example, it's shown in NodeJS using the `crypto` package to generate a new `UUID`. This new unique identifier is used in the next step.
8. Assuming that you have a `TikTok Shop image data table` with columns for a unique identifier `TikTokShop ImageId`, a TikTok Shop CDN URI `uri`, and a TikTok Shop CDN URL '`url`. Store the new unique identifier you created in step 7 in the `TikTokShopImageId` field, along with the `uri` and `url` property values that you received in step 6.
9. Update the `product image mapping data table` column `TikTokShopImageId` with the unique identifier you created in step 7.
10. You now have the complete set of parameters required to get a recommended product category from TikTok Shop. To do this, call the `POST recommend category` API, passing the product `name` you retrieved in step 1 and the product image `uri` you created in step 6.
11. If successful, the `200` response includes a recommended `leaf_category_id`.
12. Update the `local product category mapping table`. This assumes that you store product category metadata table or similar data store with a local category identifier `localCategoryId`, a TikTok Shop product category leaf identifier `TikTokShopCategoryId`, and any other indexes to additional category data that's implemented in your service.

If you're iterating a list of products, return to step 1.
## Manually map TikTok Shop product category
![Image](https://sf16-sg.tiktokcdn.com/obj/eden-sg/jvK_ylwvslclK_JWZ%5B%5B/ljhwZthlaukjlkulzlp/Integration%20Guides/cat-pre-prereq-2.png)
For this use case, your seller chooses to create a new product in your application or service using your user interface. The call flow is:

1. In your user interface, prompt the seller to provide the data for the product they want to create. The minimum amount of information at this point is the product `name` or title. Assuming that you store your product metadata in a `product data table` that includes columns for a unique product identifier `productId`, a product name or title `name` an identifier `localCategoryId` that's an index into another table that stores your local product category metadata, and an identifier `imageId` that's an index into another table that stores your local product image metadata. Store the user-provided product name or title in `name` field.
2. We'll be calling the TikTok Shop category recommendation API later on, and that operation requires at least one product image in addition to the product name or title that the user provided in step 1. In this step, prompt the user to upload a product image file using your application's user interface. When the user has selected the file, first create a new unique identifier for the product image. In this example, it's shown in NodeJS using the `crypto` package to generate a new `UUID`. This new unique identifier is used in the next step.
3. Create a new product image entry in your `product image mapping data table` by inserting the new `imageId` you created in step 2. This assumes that you have a `product image mapping data table` with columns for a unique product image identifier `imageId`, a `name`, an index into another data source that contains local image metadata `localImageId`, and an index into another data source that contains metadata about TikTok Shop product images `TikTokShopImageId`.
4. In the next four steps we'll upload the image that the seller selected in step 2 to cloud storage. This example assumes you're suing AWS S3, Azure Blob storage, or another cloud-based file storage that exposes files using HTTP GET so you can display in them in your user interface. You'll also use HTTP GET to upload the image to the TikTok Shop CDN to use the `POST recommend category` API later on. The first thing you'll need is a unique identifier for the product image, and you can generate one using the library of your choice. In this example, the NodeJS library `crypto` is used to generate a `UUID`.
5. In this step, upload the product image that your seller selected in step 2 to your chosen cloud storage. The example here is very generic, but most cloud storage providers expose a `PUT` API that accepts the file's unique identifier as a path parameter. In this example, we're passing the `UUID` you created in step 4.
6. If the upload is successful, you'll most likely receive an `HTTP 200` response.
7. Now that you've uploaded your seller's product image to cloud storage, store the `UUID` you created in step 4, along with the image URL from cloud storage that you created in step 5 in your application's product image data store. This example assumes you have a `local image data table` that includes an image identifier `localImageId` and the URL `localImageUrl` where the image file is stored in cloud storage.
8. Add the local product image identifier you created in step 4 to the `localImageId` column of the `product image mapping data table`. Note that `TiKTokShopImageId` is set to `null` here to indicate that we don't yet have any TikTok Shop product image data. We'll add that in the next 6 steps.
9. Retrieve the product image file data using the programming language and functionality of your choice. In this example, it's shown in NodeJS using the `fetch` function to retrieve a `blob`. This is because the product image file data will be sent to the `POST upload product image` API as `multipart/form-data`. If you're using a different programming language, you'll use that language's HTTP libraries for `multipart/form-data`.
10. Call the `POST upload product image` API using the product image file data `blob` that you created in step 4.
11. If successful, the `200` response includes a `data` object with a `uri` property that's a unique identifier of the image in the TikTok Shop CDN, and a `url` property that includes the URL to retrieve the product image file from the TikTok Shop CDN.
12. Generate a new unique identifier for the TikTok Shop product image data. In this example, it's shown in NodeJS using the `crypto` package to generate a new `UUID`. This new unique identifier is used in the next step.
13. Assuming that you have a `TikTok Shop image data table` with columns for a unique identifier `TikTokShop ImageId`, a TikTok Shop CDN URI `uri`, and a TikTok Shop CDN URL '`url`. Store the new unique identifier you created in step 12 in the `TikTokShopImageId` field, along with the `uri` and `url` property values that you received in step 11.
14. Update the `product image mapping data table` column `TikTokShopImageId` with the unique identifier you created in step 12.
15. Prompt your user to provide a product name or title. Then, call the `POST recommend category` API, passing the user-provided product name or title in the `product_title` parameter, and the product image `uri` you created in step 11.
16. If successful, the `200` response includes a recommended `leaf_category_id`.
17. Query the `TikTok Shop product category table` to verify that the category data return in step 16 is present. If not, add it to the table. Otherwise, continue.
18. Display the recommended TikTok Shop product category to the user and prompt them for approval. If they approve, update the `local product category mapping table`. This assumes that you store product category metadata table or similar data store with a local category identifier `localCategoryId`, a TikTok Shop product category leaf identifier `TikTokShopCategoryId`, and any other indexes to additional category data that's implemented in your service.